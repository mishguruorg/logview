{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/admin/src/github.com/mishguruorg/services/logview/packages/web/lib/auth0.tsx\";\nimport React, { useState, useEffect, useContext } from 'react';\nimport createAuth0Client from '@auth0/auth0-spa-js';\nvar GLOBAL_AUTH0 = null;\nexport var getAuth0 = function getAuth0() {\n  return GLOBAL_AUTH0;\n};\nexport var Auth0Context = React.createContext(undefined);\nexport var useAuth0 = function useAuth0() {\n  return useContext(Auth0Context);\n};\n\nvar onRedirectCallback = function onRedirectCallback(appState) {\n  window.history.replaceState({}, document.title, appState && appState.targetUrl ? appState.targetUrl : window.location.pathname);\n};\n\nexport var Auth0Provider = function Auth0Provider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      isAuthenticated = _useState2[0],\n      setIsAuthenticated = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      user = _useState4[0],\n      setUser = _useState4[1];\n\n  var _useState5 = useState(),\n      _useState6 = _slicedToArray(_useState5, 2),\n      auth0Client = _useState6[0],\n      setAuth0 = _useState6[1];\n\n  var _useState7 = useState(true),\n      _useState8 = _slicedToArray(_useState7, 2),\n      loading = _useState8[0],\n      setLoading = _useState8[1];\n\n  useEffect(function () {\n    var initAuth0 =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var auth0FromHook, _ref3, appState, isAuthenticated, _user;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return createAuth0Client({\n                  redirect_uri: 'http://localhost:3000/',\n                  domain: 'mishguruadmin.auth0.com',\n                  client_id: 'lj6liY2gXGfmrKijjPNX2rVTtGsXh6t3',\n                  audience: 'https://logview.mish.guru/'\n                });\n\n              case 2:\n                auth0FromHook = _context.sent;\n                setAuth0(auth0FromHook);\n                GLOBAL_AUTH0 = auth0FromHook;\n\n                if (!window.location.search.includes(\"code=\")) {\n                  _context.next = 17;\n                  break;\n                }\n\n                _context.prev = 6;\n                _context.next = 9;\n                return auth0FromHook.handleRedirectCallback();\n\n              case 9:\n                _ref3 = _context.sent;\n                appState = _ref3.appState;\n                onRedirectCallback(appState);\n                _context.next = 17;\n                break;\n\n              case 14:\n                _context.prev = 14;\n                _context.t0 = _context[\"catch\"](6);\n                console.error(_context.t0);\n\n              case 17:\n                _context.next = 19;\n                return auth0FromHook.isAuthenticated();\n\n              case 19:\n                isAuthenticated = _context.sent;\n                setIsAuthenticated(isAuthenticated);\n\n                if (!isAuthenticated) {\n                  _context.next = 26;\n                  break;\n                }\n\n                _context.next = 24;\n                return auth0FromHook.getUser();\n\n              case 24:\n                _user = _context.sent;\n                setUser(_user);\n\n              case 26:\n                setLoading(false);\n\n              case 27:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[6, 14]]);\n      }));\n\n      return function initAuth0() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    initAuth0()[\"catch\"](console.error);\n  }, []);\n\n  var handleRedirectCallback =\n  /*#__PURE__*/\n  function () {\n    var _ref4 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var _user2;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              setLoading(true);\n              _context2.next = 4;\n              return auth0Client.handleRedirectCallback();\n\n            case 4:\n              _context2.next = 6;\n              return auth0Client.getUser();\n\n            case 6:\n              _user2 = _context2.sent;\n              setUser(_user2);\n              setIsAuthenticated(true);\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error(_context2.t0);\n\n            case 14:\n              _context2.prev = 14;\n              setLoading(false);\n              return _context2.finish(14);\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 11, 14, 17]]);\n    }));\n\n    return function handleRedirectCallback() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return React.createElement(Auth0Context.Provider, {\n    value: {\n      isAuthenticated: isAuthenticated,\n      user: user,\n      loading: loading,\n      handleRedirectCallback: handleRedirectCallback,\n      getIdTokenClaims: function getIdTokenClaims() {\n        return auth0Client.getIdTokenClaims.apply(auth0Client, arguments);\n      },\n      loginWithRedirect: function loginWithRedirect() {\n        return auth0Client.loginWithRedirect.apply(auth0Client, arguments);\n      },\n      getTokenSilently: function getTokenSilently() {\n        return auth0Client.getTokenSilently.apply(auth0Client, arguments);\n      },\n      logout: function logout() {\n        return auth0Client.logout.apply(auth0Client, arguments);\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80\n    },\n    __self: this\n  }, children);\n};","map":{"version":3,"sources":["/home/admin/src/github.com/mishguruorg/services/logview/packages/web/lib/auth0.tsx"],"names":["React","useState","useEffect","useContext","createAuth0Client","GLOBAL_AUTH0","getAuth0","Auth0Context","createContext","undefined","useAuth0","onRedirectCallback","appState","window","history","replaceState","document","title","targetUrl","location","pathname","Auth0Provider","children","isAuthenticated","setIsAuthenticated","user","setUser","auth0Client","setAuth0","loading","setLoading","initAuth0","redirect_uri","domain","client_id","audience","auth0FromHook","search","includes","handleRedirectCallback","console","error","getUser","getIdTokenClaims","loginWithRedirect","getTokenSilently","logout"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react'\nimport createAuth0Client from '@auth0/auth0-spa-js'\n\nlet GLOBAL_AUTH0 = null\nexport const getAuth0 = () => GLOBAL_AUTH0\n\nexport const Auth0Context = React.createContext(undefined)\n\nexport const useAuth0 = () => useContext(Auth0Context)\n\nconst onRedirectCallback = (appState: Record<string, string>) => {\n  window.history.replaceState(\n    {},\n    document.title,\n    appState && appState.targetUrl\n      ? appState.targetUrl\n      : window.location.pathname\n  );\n};\n\nexport const Auth0Provider = ({\n  children,\n}) => {\n  const [isAuthenticated, setIsAuthenticated] = useState()\n  const [user, setUser] = useState()\n  const [auth0Client, setAuth0] = useState()\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const initAuth0 = async () => {\n      const auth0FromHook = await createAuth0Client({\n        redirect_uri: 'http://localhost:3000/',\n        domain: 'mishguruadmin.auth0.com',\n        client_id: 'lj6liY2gXGfmrKijjPNX2rVTtGsXh6t3',\n        audience: 'https://logview.mish.guru/'\n      })\n      setAuth0(auth0FromHook)\n      GLOBAL_AUTH0 = auth0FromHook\n\n      if (window.location.search.includes(\"code=\")) {\n        try {\n          const { appState } = await auth0FromHook.handleRedirectCallback()\n          onRedirectCallback(appState)\n        } catch (error) {\n          console.error(error)\n        }\n      }\n\n      const isAuthenticated = await auth0FromHook.isAuthenticated()\n      setIsAuthenticated(isAuthenticated)\n\n      if (isAuthenticated) {\n        const user = await auth0FromHook.getUser()\n        setUser(user)\n      }\n\n      setLoading(false)\n    }\n\n    initAuth0().catch(console.error)\n  }, [])\n\n  const handleRedirectCallback = async () => {\n    try {\n      setLoading(true)\n      await auth0Client.handleRedirectCallback()\n      const user = await auth0Client.getUser()\n      setUser(user)\n      setIsAuthenticated(true)\n    } \n    catch (error) {\n      console.error(error)\n    }\n    finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <Auth0Context.Provider\n      value={{\n        isAuthenticated,\n        user,\n        loading,\n        handleRedirectCallback,\n        getIdTokenClaims: (...p) => auth0Client.getIdTokenClaims(...p),\n        loginWithRedirect: (...p) => auth0Client.loginWithRedirect(...p),\n        getTokenSilently: (...p) => auth0Client.getTokenSilently(...p),\n        logout: (...p) => auth0Client.logout(...p)\n      }}\n    >\n      {children}\n    </Auth0Context.Provider>\n  )\n}\n\n"]},"metadata":{},"sourceType":"module"}